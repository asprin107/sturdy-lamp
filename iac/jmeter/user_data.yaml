version: 1.0
tasks:
  - task: executeScript
    inputs:
      - frequency: always
        type: powershell
        runAs: localSystem
        content: |-
          echo "Create jmeter home directory"
          New-Item -Path 'C:\Users\Administrator\Desktop\JmeterHome' -ItemType Directory
          echo "Download jmeter"
          wget https://dlcdn.apache.org//jmeter/binaries/apache-jmeter-5.5.zip -o C:\Users\Administrator\Desktop\JmeterHome\apache-jmeter-5.5.zip
          echo "Unzip jmeter"
          Expand-Archive C:\Users\Administrator\Desktop\JmeterHome\apache-jmeter-5.5.zip -DestinationPath C:\Users\Administrator\Desktop\JmeterHome
          echo "Download jdk8"
          wget https://cdn.azul.com/zulu/bin/zulu8.68.0.21-ca-jdk8.0.362-win_x64.zip -o C:\Users\Administrator\Desktop\JmeterHome\zulu8.68.0.21-ca-jdk8.0.362-win_x64.zip
          echo "Unzip jdk8"
          Expand-Archive C:\Users\Administrator\Desktop\JmeterHome\zulu8.68.0.21-ca-jdk8.0.362-win_x64.zip -DestinationPath C:\Users\Administrator\Desktop\JmeterHome
          echo "Add jdk8 in Environment 'Path'"
          # https://poshcode.gitbook.io/powershell-faq/src/getting-started/environment-variables
          $Path = "C:\Users\Administrator\Desktop\JmeterHome\zulu8.68.0.21-ca-jdk8.0.362-win_x64\bin;"
          $Path = [Environment]::GetEnvironmentVariable("PATH", "Machine") + [IO.Path]::PathSeparator + $Path
          [Environment]::SetEnvironmentVariable("Path", $Path, "Machine")